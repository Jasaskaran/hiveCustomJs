var styles=`.hidden{display:none!important}.subjRow:hover{-webkit-touch-callout:none!important;-webkit-user-select:none!important;user-select:auto!important}.chbxCol{padding-left:10px}.dateRow{display:none}.chBox.subjChBox{width:18px;height:18px;cursor:cell;box-shadow:1px 2px 0 0}.apprStatus,.rejStatus{cursor:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAAA5VJREFUSEu9V01IVFEUPs71zSKamIFgFi6M7EdqJBFNECywGhdiIEFWZlS0qdRyI0ZIhkTixn6sIKJC+zMII3GRlVCCYIYNWNGfoYsWQuDQVMS8rsR3uXe48xxn3kxOdzPz3v35zvnuOd85L4NSH36X190bmgmeIqILyR6TkeQGDxEVEVGu4TQ2VrTs2j01Pul4OzB22wyb9UQ0a/c8u8ANjLHaJctdq3JK1rlXFOTMAWBrban4fdoz7HjW1f89NBNcaRc8EXCDy+s+vaWucln2pnzH6mzXn0/ToczpFwEBqN4BuL/1zjjnHGzYGgsCG07j1vqKoppDnfsFGEAb1xztxalm2HwJqjGPZ0n1XluIclEsYA9jbLCydU8BqLzWeDNz4tHoK86530KjjzF2g3N+kogGkwHF2nnAjLExBXqiuOlHqlGbyJAoYNCLSIWnErQ6FW8SgVo99udXlTzGnaYbNAoYFNcNdRQiYh+29DSmIgp2PFVrFNVWbyEUaR0CGHd75El7zf/yNkI1aD4/eSVf3m0pEb1Jq7synXwur3v47GjH0mM5hwOa+jRAJMyw2Q5DwIoUD/FMRGoeGp1lOI1mOV9vOI2LSmgWihVQLe538/EddHlbM8QeCiREhHPeA43mnB+AcaGZoEovod2YJ6L3KBpqnTIKUqutn0dgXGAHc3xQXgL49+zPAVmFsqBamJeGCk3XxEYZrmu3nzF2Ru6pjwuMaiStHpMMKHn0EdFXnVL9WohIyWlEZpU4oYwG+kbKAezLryqZANVdZU3QZFjpwaFm2OyGlYrqX99Cn/GfiMpALdiQWp0LjyUj4qrk/kjhUDrx/NwDCvSN5AFY0KJFtaqpyGUUdv03C55q74Gtij9YwFAZofbhncfldX85eL/FfX1nWxB1W+SxxZryNOhzJIAVq0q5fF1TV1+j7mqRvWipHEugItUJk50fL1WnQUSETug043qigFES0c5oQfbPXuvFZ6Dt3l2ZflGNgAgAKBh6KH1RqugqheCMCioVjNYORPTKiwGuejakqQSNaipi9VxChRS4bFuT6USE8ehMtU5mXtO/UJcpNiMgQDOSXjZ80OYhLZdFjqJIKFHJ215cCC8xZJndEKvaxeurhexZD4LkTY68C0LFcLje5OMuLYZaO9NIuCRq6LFQVCIYgC8Idbg14OAdjNKYifs9ZQdYYfgNp7Fvjs+thZc6MLyXVafbrur9BfrqT9HR1J6NAAAAAElFTkSuQmCC),auto!important}.statColField::before{font:normal normal normal 1.3em FontAwesome;padding-right:5px}.unrStatus>.statColField::before{content:'üìî '}.readStatus>.statColField::before{content:'üìñ '}.apprStatus>.statColField::before{content:'‚úî '}.rejStatus>.statColField::before{content:'‚ùå  '}.subjCol>p>font[color=blue]::before{content:'PR'}.subjCol>p>font[color=green]::before{content:'PO'}.subjCol>p>font[color=purple]::before{content:'RFP'}.subjCol>p>font::before{margin:5px;padding-right:5px;border-right:2px solid #00008b}.subjCol:hover>p>font[color=blue],.subjCol:hover>p>font[color=green],.subjCol:hover>p>font[color=purple]{width:auto;white-space:normal}.subjCol>p>font[color=blue],.subjCol>p>font[color=green],.subjCol>p>font[color=purple]{width:120px;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;display:inline-block;font-size:13px;font-weight:700}.subjCol>p>b>font>br{display:none!important}.subjCol>p>b>font[color=red]{display:inline-block;font-weight:lighter}span.typeIcon:before{content:'';width:32px;height:32px;background-size:32px 32px}span.typeIcon.ForApproval:before{background-image:url(https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fmedia.istockphoto.com%2Fid%2F1152189152%2Fvector%2Fred-alert-icon.jpg%3Fs%3D170667a%26w%3D0%26k%3D20%26c%3DOZwpwrXwvRogsiuGQ_gS2r2nkyR8oCHUob0rRdELpOo%3D&f=1&nofb=1&ipt=bb5b4b6fc8bf9584d79447daf5990c521bc2a550ba1a433745cd56e3f583f778&ipo=images)}span.typeIcon.FYI:before{background-image:url(https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Ftse4.mm.bing.net%2Fth%3Fid%3DOIP.fOBs_QrfbvZgDiJbsGoeHQAAAA%26pid%3DApi&f=1&ipt=29838e9c2de6647ae9372d26357aa6a1bccfda653d0f9c7b196a3452df07b25c&ipo=images)}#subjFrame{float:left;width:33%}#nfyHistory{border-top:2px solid #4285f4;margin-top:10px;background:#e2edff}#nfyHistory>div{margin:5px;display:flex;flex-wrap:nowrap;font-weight:700;justify-content:space-between;border-bottom:1px solid #dbdbdb;padding-bottom:4px}#nfyHistoryHead{cursor:pointer}#nfyHistoryBody{flex-direction:column}#nfyHistoryBody>p{margin:5px;font-weight:400;cursor:pointer}#nfyHistory>div>span.icon::before{content:'üîº'}#nfyHistory.hide>div>span.icon::before{content:'üîΩ'}#nfyHistory.hide>#nfyHistoryBody{display:none}span.ItemType{padding:0 5px;border:1px solid #c5c5c5;display:inline-block}span.ItemType.Approval::after{content:'Approval';color:red}span.ItemType.FYI::after{content:'Info';color:grey}span.ItemType::before{color:#00f}span.ItemType.ALCREQAP::before{content:'PR'}span.ItemType.ALCPOA::before{content:'PO'}span.ItemType.ALCPOCOA::before{content:'PO Change Order'}span.ItemType.ALCSCRFP::before{content:'RFP'}span.ItemType.ALECAC::before{content:'Auto Charge'}span.ItemType.ALCETE::before{content:'One Time Charge'}span.date{padding:0 5px;color:#9d2525}span.approval.undefined{display:none}span.approval.true{color:green;display:block}span.approval.true::before{content:'‚úî Approved on'}span.approval.false{color:red;display:block}span.approval.false::before{content:'‚ùå Rejected on'}`;sSht=document.createElement("style");function showAll(){document.querySelectorAll("#subjContent .subjRow").forEach(function(e){e.classList.remove("hidden")})}function showChoice(t){document.querySelectorAll("#subjContent .subjRow").forEach(function(e){e.classList.remove("hidden"),e.querySelector(".typeIcon."+t)||e.classList.add("hidden")})}function AddButton(){var e=document.createElement("span");e.innerHTML=`<button class=cmicLovFindTableButton id=btn_Approval name=btn_Approval onclick=showAll() style=display:inline-block;color:#fff;background:#067734 type=button>Show All</button><button class=cmicLovFindTableButton id=btn_Approval name=btn_Approval onclick='showChoice("ForApproval")'style=display:inline-block;color:#fff;background:#b71a1a type=button>Show Approval</button><button class=cmicLovFindTableButton id=btn_Approval name=btn_Approval onclick='showChoice("FYI")'style=display:inline-block;color:#fff;background:#333 type=button>Show FYI</button>`;document.getElementById("filterButton").prepend(e)}function DoChanges(){document.querySelectorAll(".typeIcon").forEach(function(e){e.classList.remove("ForApproval","FYI"),"A"==e.innerText?(e.classList.add("ForApproval"),e.innerText=""):"F"==e.innerText&&(e.classList.add("FYI"),e.innerText="")}),document.querySelectorAll(".statCol").forEach(function(e){e.classList.remove("readStatus"),"Read"==e.innerText&&e.classList.add("readStatus")});jQuery("#refreshButton").attr("onclick","msgFrameReset();displayMsg(jQuery('div.subjRow.selSubjRow > div.subjRowSelect'));")}sSht.innerHTML=styles,document.head.appendChild(sSht),AddButton(),DoChanges();var historyPane=`<div id='nfyHistoryHead' onclick="showHideHistory()"><span>History</span><span class='icon'></span></div><div id='nfyHistoryBody'></div>`;var cDiv=document.createElement("div");cDiv.innerHTML=historyPane;cDiv.id='nfyHistory';cDiv.classList='hide';jQuery("#subjFrame").append(cDiv);function showHideHistory(){jQuery("#nfyHistory").toggleClass('hide');} function now(){return new Date().toISOString();} function fDate(d=new Date()){return new Intl.DateTimeFormat("en-GB",{timeZone:"Asia/Dubai",hour12:true,dateStyle:'short',timeStyle:'short'}).format(new Date(d));} function isOlder(date,n){let dDays=(new Date().getTime() - new Date(date).getTime()) / (1000 * 3600 * 24);return dDays > n;} let nfyList=JSON.parse(localStorage.getItem('nfyList')) || {};let nfyData=JSON.parse(localStorage.getItem('nfyData')) || {};function sDta(){localStorage.setItem('nfyList', JSON.stringify(nfyList));localStorage.setItem('nfyData', JSON.stringify(nfyData));} function showHistoryMsg(NId){msgFrameReset();var msgLoad=jQuery('#msgLoader');var div=jQuery('#msgBody');var bodyData=nfyData[NId];if(bodyData){div.html(bodyData.bodyData);}else{div.html('Missing Data');} div.fadeIn();} function getNfyData(NId){let targetUrl=`getNtfMsg.do?NtfId=${NId}`;let response=null;let request=jQuery.ajax({url: targetUrl,dataType: 'xml',async: false,success: function(data, status, xhr){response=data;}});return response;} document.querySelectorAll('.subjRow').forEach((row, index)=>{let rowId=row.querySelector('input[name="rowId"]').value;let oraseq=row.querySelector(`input[name="value(Oraseq${rowId})"]`).value;let ITyp=row.querySelector(`input[name="value(ItemType${rowId})"]`).value || null;let ItemKey=row.querySelector(`input[name="value(ItemKey${rowId})"]`).value || null;let NotiType=row.querySelector(`input[name="value(NotificationType${rowId})"]`).value || null;let NotiId=row.querySelector(`input[name="value(NotificationId${rowId})"]`).value || null;let AccessKey=row.querySelector(`input[name="value(AccessKey${rowId})"]`).value || null;let subjCol=row.querySelector('.subjCol').innerText;let exEntry=nfyList[`Oraseq${oraseq}`];if(exEntry){exEntry.visibility=true;exEntry.lastUpdate=now();} else{nfyList[`Oraseq${oraseq}`]={Oraseq: parseInt(oraseq, 10), rowId: parseInt(rowId, 10), ItemType: ITyp, ItemKey: ItemKey, NotificationType: NotiType, NotificationId: NotiId, AccessKey: AccessKey, subjCol: subjCol, addedOn: now(), visibility: true, lastUpdate: now()};let NfyData=jQuery(getNfyData(NotiId));let bData=NfyData.find('FullBody').text() || null;let UserCmnt=NfyData.find('UserComments').text() || null;nfyData[NotiId]={bodyData: bData,UserComments:UserCmnt};}});Object.keys(nfyList).forEach(key=>{if (!document.querySelector(`input[value="${nfyList[key].Oraseq}"]`)){if(nfyList[key].visibility){nfyList[key].visibility=false;nfyList[key].lastUpdate=now();}}});Object.keys(nfyList).forEach(key=>{if (nfyList[key].visibility===false && (isOlder(nfyList[key].addedOn,30) || isOlder(nfyList[key].lastUpdate,30))){delete nfyData[nfyList[key].NotificationId];delete nfyList[key];}});sDta();let nfyHistoryBody=jQuery('#nfyHistoryBody');let hItems=[];Object.keys(nfyList).forEach(key=>{if (nfyList[key].visibility===false){hItems.push({key:key, addedOn:nfyList[key].addedOn});}});hItems.sort((a, b)=>new Date(b.addedOn) - new Date(a.addedOn));hItems.forEach(item=>{let li=nfyList[item.key];let hItem=document.createElement('p');hItem.setAttribute('onclick', `showHistoryMsg(${li.NotificationId})`);hItem.innerHTML=`<span class="${li.ItemType} ${li.NotificationType} ItemType"> - </span>Added on<span class=date>${fDate(li.addedOn)}</span><span class=subject>${li.subjCol}</span><span class="${li.AppovalStatus} approval"><span class=date>${fDate(li.lastUpdate)}</span>${li.AppovalComment || ''}</span>`;nfyHistoryBody.append(hItem);});jQuery(".cmicButton").click(function(event){document.querySelectorAll('.subjRow').forEach((row, i)=>{var statusApp=row.querySelector('.apprStatus');var statusRej=row.querySelector('.rejStatus');if(statusApp || statusRej || false){let rowId=row.querySelector('input[name="rowId"]').value;let oraseq=row.querySelector(`input[name="value(Oraseq${rowId})"]`).value;let NotiId=row.querySelector(`input[name="value(NotificationId${rowId})"]`).value || null;let SApprove=row.querySelector(`input[name="value(Approve${rowId})"]`).value.toLowerCase()=='on' || false;let SReject=row.querySelector(`input[name="value(Reject${rowId})"]`).value.toLowerCase()=='on' || false;let Cmnt=row.querySelector(`input[name="value(Comment${rowId})"]`).value || null;let nfLE=nfyList[`Oraseq${oraseq}`];nfLE.AppovalStatus=(SApprove) && (!SReject);nfLE.AppovalComment=Cmnt;nfLE.lastUpdate=now();let NfyData=jQuery(getNfyData(NotiId));let bData=NfyData.find('FullBody').text() || null;let UserCmt=NfyData.find('UserComments').text() || null;nfyData[NotiId]={bodyData: bData,UserComments:UserCmt};sDta();}});});